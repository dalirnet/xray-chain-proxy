# پیشرفته

## معماری‌های چند EDGE

### EDGE های موازی

چند نقطه ورود به یک GATEWAY.

کاربردها:

- توزیع بار
- تنوع جغرافیایی
- افزونگی

راه‌اندازی: روی هر سرور `setup edge` را با اطلاعات یکسان GATEWAY اجرا کنید.

### EDGE های زنجیره‌ای

چند هاپ برای حریم خصوصی بیشتر.

کاربردها:

- لایه‌های ناشناسی اضافی
- دور زدن بازرسی عمیق بسته‌ها

راه‌اندازی:

1. GATEWAY را عادی راه‌اندازی کنید
2. EDGE 2 را به GATEWAY متصل کنید
3. EDGE 1 را به EDGE 2 متصل کنید (از اطلاعات EDGE 2 استفاده کنید)

## سطوح لاگ

| سطح     | توضیحات             |
| ------- | ------------------- |
| none    | بدون لاگ            |
| warning | فقط هشدارها و خطاها |
| info    | اطلاعات عمومی       |
| debug   | جزئیات کامل         |

تغییر با:

```bash
./xcp.sh config set
# انتخاب: 1) loglevel
```

## فایروال

اسکریپت در صورت فعال بودن UFW، پورت‌ها را باز می‌کند. برای فایروال‌های دیگر:

- TCP/UDP روی پورت Shadowsocks (443)
- TCP/UDP روی پورت HTTP (80)
- TCP/UDP روی پورت SOCKS5 (1080)

## عیب‌یابی

### Xray شروع نمی‌شود

بررسی تنظیمات:

```bash
/usr/local/xray/xray run -test -config /usr/local/xray/config.json
```

بررسی لاگ systemd:

```bash
journalctl -u xray -n 50
```

### اتصال رد شد

1. بررسی وضعیت: `./xcp.sh status`
2. بررسی فایروال: `ufw status`
3. بررسی پورت‌ها: `ss -tlnp | grep xray`

### EDGE به GATEWAY وصل نمی‌شود

1. آی‌پی/پورت GATEWAY را تایید کنید
2. مطمئن شوید GATEWAY در حال اجراست
3. تست: `curl -v telnet://GATEWAY_IP:443`
4. فایروال GATEWAY را بررسی کنید

### سرعت پایین

1. اجرا: `./xcp.sh test`
2. بررسی منابع: `top`، `free -h`
3. پروتکل دیگری امتحان کنید
4. محدودیت ISP را بررسی کنید
